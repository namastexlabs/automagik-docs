---
title: "Attempts API"
description: "Execute and manage task attempts"
icon: "flask"
---

## Overview

Attempts represent individual executions of tasks by AI agents. Each task can have multiple attempts with different agents or configurations.

**Base URL**: `/api/attempts`

---

## List Attempts

Get all attempts with filtering.

```http
GET /api/attempts
```

### Query Parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| `taskId` | string | Filter by task |
| `llm` | string | Filter by AI agent |
| `status` | enum | Filter by status |
| `page` | integer | Page number |
| `limit` | integer | Items per page |

### Status Values

- `created` - Queued, not started
- `running` - Currently executing
- `completed` - Finished successfully
- `failed` - Execution failed
- `cancelled` - Cancelled by user

### Example Request

```bash
curl "http://localhost:8080/api/attempts?taskId=task_abc123&status=completed"
```

### Example Response

```json
{
  "success": true,
  "data": [
    {
      "id": "attempt_abc123",
      "taskId": "task_xyz789",
      "llm": "claude",
      "status": "completed",
      "worktreePath": ".forge/worktrees/task-xyz-claude",
      "startedAt": "2024-01-15T10:30:00Z",
      "completedAt": "2024-01-15T10:45:00Z",
      "duration": 900000,
      "filesChanged": 8,
      "linesAdded": 245,
      "linesRemoved": 12,
      "cost": {
        "inputTokens": 15420,
        "outputTokens": 3890,
        "totalCost": 0.23
      }
    }
  ]
}
```

---

## Get Attempt

Retrieve detailed attempt information.

```http
GET /api/attempts/:id
```

### Example Response

```json
{
  "success": true,
  "data": {
    "id": "attempt_abc123",
    "taskId": "task_xyz789",
    "llm": "claude",
    "model": "claude-3-5-sonnet-20241022",
    "status": "completed",
    "worktreePath": ".forge/worktrees/task-xyz-claude",
    "startedAt": "2024-01-15T10:30:00Z",
    "completedAt": "2024-01-15T10:45:00Z",
    "duration": 900000,
    "changes": {
      "filesChanged": 8,
      "filesCreated": 2,
      "filesModified": 6,
      "filesDeleted": 0,
      "linesAdded": 245,
      "linesRemoved": 12
    },
    "cost": {
      "inputTokens": 15420,
      "outputTokens": 3890,
      "totalCost": 0.23
    },
    "output": {
      "summary": "Successfully implemented JWT authentication",
      "changes": [
        "Created src/auth/jwt.ts for token generation",
        "Added login endpoint to src/api/auth.ts",
        "Added signup endpoint with validation",
        "Created authentication middleware",
        "Added comprehensive tests"
      ]
    }
  }
}
```

---

## Create Attempt

Start a new attempt for a task.

```http
POST /api/attempts
```

### Request Body

```json
{
  "taskId": "task_xyz789",
  "llm": "claude",
  "options": {
    "temperature": 0.7,
    "maxTokens": 4096,
    "timeout": 60000
  },
  "description": "Focus on security and edge cases"
}
```

### Example Request

```bash
curl -X POST http://localhost:8080/api/attempts \
  -H "Content-Type: application/json" \
  -d '{
    "taskId": "task_xyz789",
    "llm": "claude"
  }'
```

### Example Response

```json
{
  "success": true,
  "data": {
    "id": "attempt_new123",
    "taskId": "task_xyz789",
    "llm": "claude",
    "status": "created",
    "createdAt": "2024-01-15T11:00:00Z"
  }
}
```

---

## Start Attempt

Begin execution of a created attempt.

```http
POST /api/attempts/:id/start
```

### Example Request

```bash
curl -X POST http://localhost:8080/api/attempts/attempt_new123/start
```

### Example Response

```json
{
  "success": true,
  "data": {
    "id": "attempt_new123",
    "status": "running",
    "startedAt": "2024-01-15T11:00:00Z",
    "processId": "proc_abc123"
  }
}
```

---

## Cancel Attempt

Stop a running attempt.

```http
POST /api/attempts/:id/cancel
```

### Example Request

```bash
curl -X POST http://localhost:8080/api/attempts/attempt_abc123/cancel
```

### Example Response

```json
{
  "success": true,
  "data": {
    "id": "attempt_abc123",
    "status": "cancelled",
    "cancelledAt": "2024-01-15T11:05:00Z"
  }
}
```

---

## Delete Attempt

Remove an attempt and cleanup worktree.

```http
DELETE /api/attempts/:id
```

<Warning>
This permanently deletes the attempt and removes the associated Git worktree.
</Warning>

### Example Request

```bash
curl -X DELETE http://localhost:8080/api/attempts/attempt_abc123
```

---

## Get Attempt Logs

Retrieve execution logs for an attempt.

```http
GET /api/attempts/:id/logs
```

### Query Parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| `follow` | boolean | Stream logs in real-time |
| `level` | enum | Filter by log level |
| `since` | timestamp | Only logs after this time |

### Example Request

```bash
curl "http://localhost:8080/api/attempts/attempt_abc123/logs?follow=true"
```

### Example Response (Streaming)

```json
{"level":"info","message":"Starting attempt execution","timestamp":"2024-01-15T10:30:00Z"}
{"level":"info","message":"Creating git worktree","timestamp":"2024-01-15T10:30:01Z"}
{"level":"info","message":"Worktree created: .forge/worktrees/task-xyz-claude","timestamp":"2024-01-15T10:30:02Z"}
{"level":"info","message":"Initializing LLM: claude","timestamp":"2024-01-15T10:30:03Z"}
{"level":"info","message":"Generating code...","timestamp":"2024-01-15T10:30:05Z"}
{"level":"info","message":"Created file: src/auth/jwt.ts","timestamp":"2024-01-15T10:32:15Z"}
```

---

## Get Attempt Diff

Get code changes made by the attempt.

```http
GET /api/attempts/:id/diff
```

### Query Parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| `file` | string | Specific file to diff |
| `format` | enum | `unified`, `split`, `json` (default: unified) |

### Example Request

```bash
curl "http://localhost:8080/api/attempts/attempt_abc123/diff?format=json"
```

### Example Response

```json
{
  "success": true,
  "data": {
    "files": [
      {
        "path": "src/auth/jwt.ts",
        "status": "added",
        "additions": 67,
        "deletions": 0,
        "changes": [
          {
            "type": "add",
            "lineNumber": 1,
            "content": "import jwt from 'jsonwebtoken';"
          }
        ]
      },
      {
        "path": "src/api/auth.ts",
        "status": "modified",
        "additions": 132,
        "deletions": 13,
        "changes": [...]
      }
    ],
    "summary": {
      "filesChanged": 8,
      "additions": 245,
      "deletions": 12
    }
  }
}
```

---

## Merge Attempt

Merge attempt changes into main branch.

```http
POST /api/attempts/:id/merge
```

### Request Body

```json
{
  "message": "Add JWT authentication",
  "strategy": "squash",
  "cleanup": true
}
```

### Merge Strategies

- `ff` - Fast-forward merge (default)
- `no-ff` - Create merge commit
- `squash` - Squash commits into one

### Example Request

```bash
curl -X POST http://localhost:8080/api/attempts/attempt_abc123/merge \
  -H "Content-Type: application/json" \
  -d '{
    "message": "Add JWT authentication (Claude implementation)",
    "strategy": "squash",
    "cleanup": true
  }'
```

### Example Response

```json
{
  "success": true,
  "data": {
    "attemptId": "attempt_abc123",
    "commitSha": "abc123def456",
    "merged": true,
    "mergedAt": "2024-01-15T11:10:00Z",
    "cleanup": true
  }
}
```

---

## Compare Attempts

Compare two attempts side-by-side.

```http
POST /api/attempts/compare
```

### Request Body

```json
{
  "attemptIds": ["attempt_1", "attempt_2"]
}
```

### Example Response

```json
{
  "success": true,
  "data": {
    "attempts": [
      {
        "id": "attempt_1",
        "llm": "claude",
        "duration": 900000,
        "cost": 0.23,
        "filesChanged": 8,
        "linesAdded": 245
      },
      {
        "id": "attempt_2",
        "llm": "gemini",
        "duration": 450000,
        "cost": 0.00,
        "filesChanged": 6,
        "linesAdded": 189
      }
    ],
    "comparison": {
      "fasterAttempt": "attempt_2",
      "cheaperAttempt": "attempt_2",
      "moreCompleteAttempt": "attempt_1"
    }
  }
}
```

---

## SDK Examples

### JavaScript/TypeScript

```typescript
import { ForgeClient } from '@automagik/forge-sdk';

const forge = new ForgeClient();

// List attempts
const attempts = await forge.attempts.list({
  taskId: 'task_xyz789',
  status: 'completed'
});

// Create and start attempt
const attempt = await forge.attempts.create({
  taskId: 'task_xyz789',
  llm: 'claude'
});

await forge.attempts.start(attempt.id);

// Get logs (streaming)
const logs = await forge.attempts.logs(attempt.id, {
  follow: true
});

for await (const log of logs) {
  console.log(log.message);
}

// Get diff
const diff = await forge.attempts.diff(attempt.id);

// Merge when ready
await forge.attempts.merge(attempt.id, {
  message: 'Add authentication',
  strategy: 'squash',
  cleanup: true
});

// Compare attempts
const comparison = await forge.attempts.compare([
  'attempt_1',
  'attempt_2'
]);
```

### Python

```python
from automagik_forge import ForgeClient

forge = ForgeClient()

# Create and start attempt
attempt = forge.attempts.create(
    task_id='task_xyz789',
    llm='claude'
)

forge.attempts.start(attempt.id)

# Stream logs
for log in forge.attempts.logs(attempt.id, follow=True):
    print(log.message)

# Get diff
diff = forge.attempts.diff(attempt.id)

# Merge
forge.attempts.merge(
    attempt.id,
    message='Add authentication',
    strategy='squash',
    cleanup=True
)
```

---

## WebSocket Events

Subscribe to real-time attempt updates:

```javascript
const ws = new WebSocket('ws://localhost:8080/ws');

ws.send(JSON.stringify({
  type: 'subscribe',
  channel: 'attempts',
  attemptId: 'attempt_abc123'
}));

ws.onmessage = (event) => {
  const update = JSON.parse(event.data);
  // { type: 'attempt.status_changed', attemptId: '...', status: 'running' }
};
```

---

## Next Steps

<CardGroup cols={2}>
  <Card title="Tasks API" icon="list-check" href="/forge/api/tasks">
    Manage tasks
  </Card>

  <Card title="Processes API" icon="gear" href="/forge/api/processes">
    Monitor running processes
  </Card>

  <Card title="MCP Tools" icon="plug" href="/forge/api/mcp-tools">
    Use from AI agents
  </Card>
</CardGroup>
